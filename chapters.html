<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Adventures of an Engineer - –°–ø–∏—Å–æ–∫ –≥–ª–∞–≤</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öôÔ∏è</text></svg>">
    <style>
        .chapters-page {
            padding: 80px 0;
        }
        
        .chapters-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .chapter-detailed-item {
            background-color: var(--color-card);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--color-border);
            display: flex;
            align-items: flex-start;
            gap: 20px;
            transition: transform var(--transition-speed);
        }
        
        .chapter-detailed-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px var(--color-shadow);
        }
        
        .chapter-number {
            background: linear-gradient(135deg, var(--color-accent), #4361ee);
            color: #121212;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .chapter-content {
            flex: 1;
        }
        
        .chapter-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--color-text);
        }
        
        .chapter-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .meta-item {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .read-badge {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--color-accent);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .chapter-description {
            color: var(--color-text-secondary);
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        .chapter-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 150px;
        }
        
        .chapters-stats {
            background: var(--color-card);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            border: 1px solid var(--color-border);
        }
        
        .progress-bar-container {
            background: var(--color-bg);
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--color-accent), #4361ee);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 5px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            color: var(--color-text);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--color-text-secondary);
        }
        
        .spinner {
            border: 3px solid var(--color-border);
            border-radius: 50%;
            border-top: 3px solid var(--color-accent);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .chapter-detailed-item {
                flex-direction: column;
                gap: 15px;
            }
            
            .chapter-actions {
                width: 100%;
                flex-direction: row;
                justify-content: flex-start;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <a href="index.html" class="logo">
                    <div class="logo-img">‚öôÔ∏è</div>
                    <span class="logo-text">The Adventures of an Engineer</span>
                </a>
                
                <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
                <nav class="nav">
                    <ul class="nav-list">
                        <li class="nav-item"><a href="index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li class="nav-item"><a href="about-book.html" class="nav-link">–û –∫–Ω–∏–≥–µ</a></li>
                        <li class="nav-item"><a href="reading.html" class="nav-link">–ß—Ç–µ–Ω–∏–µ</a></li>
                        <li class="nav-item"><a href="chapters.html" class="nav-link active">–ì–ª–∞–≤—ã</a></li>
                        <li class="nav-item"><a href="encyclopedia.html" class="nav-link">–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è</a></li>
                        <li class="nav-item"><a href="faq.html" class="nav-link">FAQ</a></li>
                        <li class="nav-item"><a href="contacts.html" class="nav-link">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                    </ul>
                </nav>
                
                <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é -->
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    <main class="main chapters-page">
        <div class="container">
            <h1 class="section-title">–°–ø–∏—Å–æ–∫ –≥–ª–∞–≤</h1>
            <p class="section-subtitle" style="text-align: center; margin-bottom: 40px; color: #a0a0a0;">
                –í—Å–µ –≥–ª–∞–≤—ã –∫–Ω–∏–≥–∏ "The Adventures of an Engineer"
            </p>
            
            <div class="chapters-container">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
                <div class="chapters-stats">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalChapters">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –≥–ª–∞–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="readChaptersCount">0</div>
                            <div class="stat-label">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="progressPercentage">0%</div>
                            <div class="stat-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="readingTime">0 —á</div>
                            <div class="stat-label">–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <div style="color: var(--color-text-secondary); margin-bottom: 10px; font-size: 0.9rem;">
                            –ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è:
                            <span id="progressText" style="color: var(--color-text); font-weight: 600;">0 –∏–∑ 0 –≥–ª–∞–≤</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button id="markAllAsRead" class="btn btn-small" style="background: var(--color-bg); border: 1px solid var(--color-border);">
                            –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
                        </button>
                        <button id="resetProgress" class="btn btn-small" style="background: var(--color-bg); border: 1px solid var(--color-border);">
                            –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                        </button>
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –≥–ª–∞–≤ -->
                <div class="chapters-list-detailed" id="chaptersList">
                    <div class="empty-state" id="loadingState">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≥–ª–∞–≤...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <a href="index.html" class="logo">
                        <div class="logo-img">‚öôÔ∏è</div>
                        <span class="logo-text">The Adventures of an Engineer</span>
                    </a>
                    <p class="footer-text">–û–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –∫–Ω–∏–≥–∏ –æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—Ç–∫—Ä—ã—Ç–∏—è—Ö –∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö —Å–≤–µ—Ä—à–µ–Ω–∏—è—Ö</p>
                </div>
                
                <div class="footer-links">
                    <h3 class="footer-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                    <ul class="footer-list">
                        <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li><a href="about-book.html">–û –∫–Ω–∏–≥–µ</a></li>
                        <li><a href="reading.html">–ß—Ç–µ–Ω–∏–µ</a></li>
                        <li><a href="chapters.html">–ì–ª–∞–≤—ã</a></li>
                        <li><a href="encyclopedia.html">–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                    </ul>
                </div>
                
                <div class="footer-info">
                    <h3 class="footer-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <p>–ö–Ω–∏–≥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è</p>
                    <p>–ü—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º</p>
                    <p>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>¬© <span id="currentYear">2023</span> The Adventures of an Engineer. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã Joly Jayson.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const BOOK_FILE = 'book/the-adventures-of-an-engineer.txt';
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let bookChapters = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async function() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞ –≤ —Ñ—É—Ç–µ—Ä
            const yearSpans = document.querySelectorAll('#currentYear');
            yearSpans.forEach(span => {
                span.textContent = new Date().getFullYear();
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–ª–∞–≤
            await loadAndDisplayChapters();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            setupEventHandlers();
        });
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–ª–∞–≤
        async function loadAndDisplayChapters() {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
                showLoadingState();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª —Å –∫–Ω–∏–≥–æ–π
                const response = await fetch(BOOK_FILE);
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status} ${response.statusText}`);
                }
                
                const bookText = await response.text();
                
                // –†–∞–∑–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –≥–ª–∞–≤—ã
                bookChapters = parseChapters(bookText);
                
                if (bookChapters.length === 0) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –≥–ª–∞–≤—ã –≤ —Ñ–∞–π–ª–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.');
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–ª–∞–≤
                displayChaptersList();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateStatistics();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–ª–∞–≤:', error);
                showErrorState(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≥–ª–∞–≤: ${error.message}`);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –≥–ª–∞–≤—ã
        function parseChapters(text) {
            const chapters = [];
            
            // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –≥–ª–∞–≤
            const patterns = [
                /^## –ì–ª–∞–≤–∞ (\d+):?\s*(.*?)$/gm,      // ## –ì–ª–∞–≤–∞ 1: –ù–∞–∑–≤–∞–Ω–∏–µ
                /^## Chapter (\d+):?\s*(.*?)$/gm,    // ## Chapter 1: Title
                /^–ì–ª–∞–≤–∞ (\d+)[:.\s]*(.*?)$/gm,       // –ì–ª–∞–≤–∞ 1: –ù–∞–∑–≤–∞–Ω–∏–µ
                /^Chapter (\d+)[:.\s]*(.*?)$/gm,     // Chapter 1: Title
                /^# (\d+)\.\s*(.*?)$/gm,             // # 1. –ù–∞–∑–≤–∞–Ω–∏–µ
            ];
            
            let matches = [];
            let usedPattern = null;
            
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
            for (const pattern of patterns) {
                pattern.lastIndex = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å
                const patternMatches = [...text.matchAll(pattern)];
                
                if (patternMatches.length > 0) {
                    matches = patternMatches;
                    usedPattern = pattern;
                    break;
                }
            }
            
            if (matches.length === 0) {
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–æ–∑–¥–∞–µ–º –æ–¥–Ω—É –≥–ª–∞–≤—É
                return [{
                    number: 1,
                    title: '–ö–Ω–∏–≥–∞',
                    content: text.trim(),
                    start: 0
                }];
            }
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –≥–ª–∞–≤
            for (let i = 0; i < matches.length; i++) {
                const match = matches[i];
                const chapterNumber = parseInt(match[1]) || (i + 1);
                const chapterTitle = match[2].trim() || `–ì–ª–∞–≤–∞ ${chapterNumber}`;
                const chapterStart = match.index + match[0].length;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω–µ—Ü –≥–ª–∞–≤—ã (–Ω–∞—á–∞–ª–æ —Å–ª–µ–¥—É—é—â–µ–π –∏–ª–∏ –∫–æ–Ω–µ—Ü —Ç–µ–∫—Å—Ç–∞)
                const chapterEnd = (i < matches.length - 1) 
                    ? matches[i + 1].index 
                    : text.length;
                
                const chapterContent = text.substring(chapterStart, chapterEnd).trim();
                
                chapters.push({
                    number: chapterNumber,
                    title: chapterTitle,
                    content: chapterContent,
                    start: chapterStart
                });
            }
            
            return chapters;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≥–ª–∞–≤
        function displayChaptersList() {
            const chaptersList = document.getElementById('chaptersList');
            
            if (bookChapters.length === 0) {
                chaptersList.innerHTML = `
                    <div class="empty-state">
                        <p>–ì–ª–∞–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                `;
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const readChapters = JSON.parse(localStorage.getItem('bookflow_read_chapters') || '[]');
            
            let chaptersHTML = '';
            
            bookChapters.forEach(chapter => {
                const chapterKey = `1-${chapter.number}`;
                const isRead = readChapters.includes(chapterKey);
                
                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–ª–æ–≤–∞ –∏ –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è
                const wordCount = countWords(chapter.content);
                const readingTime = Math.ceil(wordCount / 200); // 200 —Å–ª–æ–≤ –≤ –º–∏–Ω—É—Ç—É
                const preview = getChapterPreview(chapter.content);
                
                chaptersHTML += `
                    <div class="chapter-detailed-item" data-chapter="${chapter.number}">
                        <div class="chapter-number">${chapter.number}</div>
                        <div class="chapter-content">
                            <h3 class="chapter-title">–ì–ª–∞–≤–∞ ${chapter.number}: ${chapter.title}</h3>
                            <div class="chapter-meta">
                                <span class="meta-item">‚è±Ô∏è ~${readingTime} –º–∏–Ω</span>
                                <span class="meta-item">üìñ ~${wordCount} —Å–ª–æ–≤</span>
                                ${isRead ? '<span class="read-badge">‚úì –ü—Ä–æ—á–∏—Ç–∞–Ω–æ</span>' : ''}
                            </div>
                            <p class="chapter-description">${preview}</p>
                        </div>
                        <div class="chapter-actions">
                            <a href="reading.html?chapter=${chapter.number}" class="btn btn-small ${isRead ? 'btn-secondary' : 'btn-primary'}">
                                ${isRead ? '–ü–µ—Ä–µ—á–∏—Ç–∞—Ç—å' : '–ß–∏—Ç–∞—Ç—å'}
                            </a>
                            ${!isRead ? `
                                <button class="btn btn-small mark-chapter-read" data-chapter="${chapter.number}" style="background: var(--color-bg); border: 1px solid var(--color-border);">
                                    –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            chaptersList.innerHTML = chaptersHTML;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π"
            document.querySelectorAll('.mark-chapter-read').forEach(button => {
                button.addEventListener('click', function() {
                    const chapterNum = this.dataset.chapter;
                    markChapterAsRead(chapterNum);
                });
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å–ª–æ–≤
        function countWords(text) {
            return text.split(/\s+/).filter(word => word.length > 0).length;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–≤—å—é –≥–ª–∞–≤—ã
        function getChapterPreview(text) {
            const firstParagraph = text.split(/\n\s*\n/)[0];
            if (!firstParagraph) return '–ù–∞—á–∞–ª–æ –≥–ª–∞–≤—ã...';
            
            // –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
            let preview = firstParagraph.trim();
            
            // –û–±—Ä–µ–∑–∞–µ–º –¥–æ 150 —Å–∏–º–≤–æ–ª–æ–≤
            if (preview.length > 150) {
                preview = preview.substring(0, 150) + '...';
            }
            
            return preview;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatistics() {
            const totalChapters = bookChapters.length;
            const readChapters = JSON.parse(localStorage.getItem('bookflow_read_chapters') || '[]');
            const readCount = readChapters.length;
            const percentage = totalChapters > 0 ? Math.round((readCount / totalChapters) * 100) : 0;
            
            // –û–±—â–µ–µ –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è (–≤ –º–∏–Ω—É—Ç–∞—Ö)
            let totalReadingTime = 0;
            bookChapters.forEach(chapter => {
                totalReadingTime += Math.ceil(countWords(chapter.content) / 200);
            });
            const totalHours = Math.floor(totalReadingTime / 60);
            const totalMinutes = totalReadingTime % 60;
            const readingTimeText = totalHours > 0 ? `${totalHours} —á ${totalMinutes} –º–∏–Ω` : `${totalMinutes} –º–∏–Ω`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            document.getElementById('totalChapters').textContent = totalChapters;
            document.getElementById('readChaptersCount').textContent = readCount;
            document.getElementById('progressPercentage').textContent = percentage + '%';
            document.getElementById('readingTime').textContent = readingTimeText;
            document.getElementById('progressText').textContent = `${readCount} –∏–∑ ${totalChapters} –≥–ª–∞–≤`;
            document.getElementById('progressBar').style.width = percentage + '%';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ—Ç–∫–∏ –≥–ª–∞–≤—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π
        function markChapterAsRead(chapterNum) {
            const chapterKey = `1-${chapterNum}`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
            let readChapters = JSON.parse(localStorage.getItem('bookflow_read_chapters') || '[]');
            
            if (!readChapters.includes(chapterKey)) {
                readChapters.push(chapterKey);
                localStorage.setItem('bookflow_read_chapters', JSON.stringify(readChapters));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                const chapterElement = document.querySelector(`.chapter-detailed-item[data-chapter="${chapterNum}"]`);
                if (chapterElement) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –±–µ–π–¥–∂
                    const metaElement = chapterElement.querySelector('.chapter-meta');
                    if (!metaElement.querySelector('.read-badge')) {
                        const badge = document.createElement('span');
                        badge.className = 'read-badge';
                        badge.textContent = '‚úì –ü—Ä–æ—á–∏—Ç–∞–Ω–æ';
                        metaElement.appendChild(badge);
                    }
                    
                    // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É
                    const actionsElement = chapterElement.querySelector('.chapter-actions');
                    const readButton = actionsElement.querySelector('.mark-chapter-read');
                    if (readButton) {
                        readButton.remove();
                    }
                    
                    const mainButton = actionsElement.querySelector('.btn-small');
                    if (mainButton) {
                        mainButton.className = 'btn btn-small btn-secondary';
                        mainButton.textContent = '–ü–µ—Ä–µ—á–∏—Ç–∞—Ç—å';
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateStatistics();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification(`–ì–ª–∞–≤–∞ ${chapterNum} –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–∞—è!`, 'success');
            } else {
                showNotification('–≠—Ç–∞ –≥–ª–∞–≤–∞ —É–∂–µ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–∞—è', 'info');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventHandlers() {
            // –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ"
            document.getElementById('markAllAsRead').addEventListener('click', () => {
                if (confirm('–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –≥–ª–∞–≤—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ?')) {
                    const readChapters = [];
                    bookChapters.forEach(chapter => {
                        readChapters.push(`1-${chapter.number}`);
                    });
                    
                    localStorage.setItem('bookflow_read_chapters', JSON.stringify(readChapters));
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–ª–∞–≤
                    displayChaptersList();
                    updateStatistics();
                    
                    showNotification('–í—Å–µ –≥–ª–∞–≤—ã –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ!', 'success');
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            document.getElementById('resetProgress').addEventListener('click', () => {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –í—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –≥–ª–∞–≤—ã –±—É–¥—É—Ç –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ.')) {
                    localStorage.removeItem('bookflow_read_chapters');
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–ª–∞–≤
                    displayChaptersList();
                    updateStatistics();
                    
                    showNotification('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω', 'success');
                }
            });
            
            // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const nav = document.querySelector('.nav');
            
            if (mobileMenuBtn && nav) {
                mobileMenuBtn.addEventListener('click', () => {
                    nav.classList.toggle('active');
                    mobileMenuBtn.classList.toggle('active');
                });
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫—É
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        nav.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                    }
                });
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoadingState() {
            document.getElementById('chaptersList').innerHTML = `
                <div class="empty-state" id="loadingState">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≥–ª–∞–≤...</p>
                </div>
            `;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—à–∏–±–∫–∏
        function showErrorState(message) {
            document.getElementById('chaptersList').innerHTML = `
                <div class="empty-state">
                    <p style="color: #ff6b6b; margin-bottom: 15px;">–û—à–∏–±–∫–∞</p>
                    <p style="margin-bottom: 20px;">${message}</p>
                    <button onclick="location.reload()" class="btn btn-primary">
                        –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    </button>
                </div>
            `;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message, type = 'info') {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: 600;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            if (type === 'error') {
                notification.style.background = '#ff6b6b';
                notification.style.color = '#121212';
            } else if (type === 'success') {
                notification.style.background = '#4cc9f0';
                notification.style.color = '#121212';
            } else if (type === 'info') {
                notification.style.background = '#4361ee';
                notification.style.color = '#fff';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>